



type test = 
db /test : list(


onready() =
        values = [
            {str="Coucou" i=10 k=0},
            {str="Salut" i=0 k=1},
            {str="Bonjour" i=67 k=2},
        ]
        columns = [
            TableBuilder.mk_column(
                <>String</>,
                (r,_chan -> <>{r.str}</>),
                some(r1, r2 -> String.ordering(r1.str, r2.str)),
                none
            ),
            TableBuilder.mk_column(
                <>Int</>,
                (r,_chan -> <>{r.i}</>),
                some(r1, r2 -> Int.ordering(r1.i, r2.i)),
                none
            ),
            TableBuilder.mk_column(
                <>Tool</>,
                (r,chan -> 
                    <button onclick={_->Session.send(chan, {del_filter=(v->v.k == r.k)})}>Del</button>
                    <button onclick={_->db_change(
                ),
                none,
                none
            )
        ]
        spec = TableBuilder.mk_spec(
            columns,
            values
        )
        key() = String.to_int(Dom.get_value(#key))
        str() = Dom.get_value(#str)
        i() = String.to_int(Dom.get_value(#int))
        row() = {str=str() i=i() k=Random.int(1000000)}
        table = TableBuilder.make(spec)
        xhtml = <>
        str : <input id=#str/> 
        int : <input id=#int /> 
        key : <input id=#key/>
        <button onclick={_-> Session.send(table.channel, {add=row()})}>Ajouter</button>
        <button onclick={_-> Session.send(table.channel, {del_key=key()})}>Del key</button>
        <button onclick={_-> Session.send(table.channel, {edit_key={key=key() row=row()}})}>Editer key</button>
        {table.xhtml}
        </>
    Dom.transform([#onready <- xhtml])

main() =
       <div id=#onready onready={_->onready()}></div>


server = Server.one_page_server("Test", main)
